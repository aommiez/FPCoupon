/* ! speed-kit 1.12.3 | Copyright (c) 2018 Baqend GmbH */
"use strict";function t(){const{userAgent:t}=navigator,e=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];let s=null;if(/trident/i.test(e[1]))return s=/\brv[ :]+(\d+)/g.exec(t)||[],["IE ",parseInt(s[1],10)||0];if("Chrome"===e[1]&&null!=(s=t.match(/\b(Edge)\/(\d+)/)))return[s.slice(1)[0],parseInt(s.slice(1)[1],10)];const i=e[2]?[e[1],parseInt(e[2],10)]:[navigator.appName,parseInt(navigator.appVersion,10)];return null!=(s=t.match(/version\/(\d+)/i))&&i.splice(1,1,parseInt(s[1],10)),i}function e(t){if("string"!=typeof t)return null;const e=/^regexp:\/(.*)\/([\w]*)$/.exec(t);if(e){const[,t,s]=e;return new RegExp(t,s)}return null}function s(t){return JSON.parse(t,(t,s)=>"string"==typeof s&&e(s)||s)}function i(t){return`regexp:/${t.source}/${t.flags||""}`}const r="baqend-speedkit";async function n(t,e,s){const i=caches.open(s);return(await i).put(t,e)}async function a(t,e){return n(t,new Response(null,{status:200,statusText:(s=e,JSON.stringify(s,(t,e)=>e instanceof RegExp?i(e):e))}),r);var s}async function o(t,e){const s=caches.open(e);return(await s).match(t,{cacheName:e})}async function c(t,e){const i=await o(t,r);return i?s(i.statusText):e}function h(t,e){const s=3&e.length,i=e.length-s,r=3432918353,n=461845907;let a,o,c,h;for(a=t,h=0;h<i;)c=255&e.charCodeAt(h)|(255&e.charCodeAt(h+=1))<<8|(255&e.charCodeAt(h+=1))<<16|(255&e.charCodeAt(h+=1))<<24,h+=1,a=27492+(65535&(o=5*(65535&(a=(a^=c=(65535&(c=(c=(65535&c)*r+(((c>>>16)*r&65535)<<16)&4294967295)<<15|c>>>17))*n+(((c>>>16)*n&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(c=0,s){case 3:c^=(255&e.charCodeAt(h+2))<<16;case 2:c^=(255&e.charCodeAt(h+1))<<8;case 1:a^=c=(65535&(c=(c=(65535&(c^=255&e.charCodeAt(h)))*r+(((c>>>16)*r&65535)<<16)&4294967295)<<15|c>>>17))*n+(((c>>>16)*n&65535)<<16)&4294967295}return a^=e.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295,(a^=a>>>16)>>>0}class l{constructor(t,e=62353,s=5){this.r=t,this.s=e,this.t=s}static fromBuffer(t){const e=new Int32Array(t,0,2),[s,i]=e;return new l(new Uint8Array(t,8),s,i)}static fromJSON(t){return new l((e=t.b,Uint8Array.from([...atob(e)].map(t=>t.charCodeAt(0)))),t.m,t.h);var e}contains(t){return this.p(t).every(t=>this.q(t))}p(t){const e=[],s=h(0,t),i=h(s,t);for(let t=0;t<this.t;t+=1)e[t]=(s+t*i)%this.s;return e}q(t){const e=this.r[t>>3];if(e){return 0!=(e&1<<(7&t))}return!1}}var u;function d(t){return new Promise(e=>setTimeout(e,t))}!function(t){t[t.Ok=200]="Ok",t[t.BaqendRedirect=231]="BaqendRedirect",t[t.MovedPermanently=301]="MovedPermanently",t[t.BadRequest=400]="BadRequest",t[t.Forbidden=403]="Forbidden",t[t.InternalServerError=500]="InternalServerError",t[t.BadGateway=502]="BadGateway",t[t.FetchTypeError=542]="FetchTypeError"}(u||(u={}));class m{constructor(t){this.public=t.has("public"),this.private=t.has("private"),this.noCache=t.has("no-cache"),this.onlyIfCached=t.has("only-if-cached"),this.maxAge=t.get("max-age"),this.swMaxAge=t.get("sw-max-age"),this.maxStale=t.get("max-stale"),this.minFresh=t.get("min-fresh"),this.staleWhileRevalidate=t.get("stale-while-revalidate"),this.staleIfError=t.get("stale-if-error"),this.mustRevalidate=t.has("must-revalidate"),this.proxyRevalidate=t.has("proxy-revalidate"),this.immutable=t.has("immutable"),this.noStore=t.has("no-store"),this.noTransform=t.has("no-transform")}static fromString(t){const e=t.split(/,\s*/).map(t=>t.split("=",2)).map(([t,e])=>[t,e?parseInt(e,10):-1]),s=new Map(e);return new m(s)}}function p(t,e){const s=t.headers.get("date")||"";return Date.parse(s)+e}function f(t,e){return m.fromString(t.headers.get(e)||"")}function g(t,e){const s=f(t,"cache-control"),i=f(t,"baqend-sw-control"),r=function(...t){for(const e of t)if(null!=e)return e;return null}(s.swMaxAge,i.maxAge,s.maxAge),n=t.headers.get("date");if(n&&null!=r){const s=function(t,e,s=0){const i=t.headers.get(e);return null==i?s:parseInt(i,10)}(t,"age"),i=(new Date(n),p(t,e)+1e3*(r-s));return Date.now()<i}const a=t.headers.get("expires");return!!a&&Date.now()<new Date(a).getTime()}async function w(t,e){const s=await t.blob();return new Response(s,e)}const b="1",v=`${location.origin}/com.baqend.speedkit.clockdrift`,y=216e5;class A{constructor(t,e,s,i){this.f=null,this.g=0,this.h=!1,this.i=!1,this.j=!1,this.k=0,this.l=0,this.m=t,this.c=e,this.d=s,this.e=i,this.n=new Set}noBloomFilterLoaded(){return null==this.f}isFromSameSession(){if(this.noBloomFilterLoaded())return!1;const t=this.g+1e3*this.d>Date.now();return t}isStale(t){return!this.isOnRevalidationWhitelist(t)&&(null!=this.f&&this.f.contains(t))}isDisconnected(){return this.i}getRevision(){return b}getClockDrift(){return this.k}setClockDrift(t){this.k=t}addToRevalidationWhitelist(t){this.n.add(t)}isOnRevalidationWhitelist(t){return this.n.has(t)}async purgeBloomFilter(){await async function(t,e){const s=await caches.open(e);await s.delete(t,{cacheName:e})}(this.e,r),this.f=null,this.fetchBloomFilter()}async init(){const t=Date.now();if(this.f)return this.g>t||(this.fetchBloomFilter(),!1);this.setClockDrift(await c(v,this.k));const e=await o(this.e,r);if(e){const s=this.getClockDrift();this.g=p(e,s)+1e3*this.c;const i=await e.json();if(this.f=l.fromJSON(i),this.g>t)return!0}return this.fetchBloomFilter(),!1}connect(){this.l=0,this.i=!1}async disconnect(t){if(this.i=!0,"unregister"===t)return this.j=!0,void registration.unregister();if("noReconnect"===t||this.j)return;const e=this.m*Math.pow(5,this.l);return this.l+=1,await d(Math.min(e,y)),this.fetchBloomFilter()}async fetchBloomFilter(){if(this.h||!navigator.onLine)return;this.h=!0;let t=!1;try{const e={accept:"application/octet-stream, application/json;q=0.7"},s=new URL(this.e);s.searchParams.append("BCB","1"),s.searchParams.append("skversion","1.12.3");const i=await fetch(s.toString(),{headers:e}),o=i.clone();if(i.status!==u.Ok)throw i.status===u.Forbidden&&(t=!0),new Error(`Bloom filter fetch failed, status: ${i.status}`);if((i.headers.get("baqend-speed-kit")||"").includes("disabled=true"))throw new Error("Speed Kit Disabled on Server");this.j||(this.l=0,this.i=!1);const c=i.headers.get("content-type");if(c.startsWith("application/octet-stream")){const t=await i.arrayBuffer();this.f=l.fromBuffer(t)}else{if(!c.startsWith("application/json"))throw new Error(`Weird server reply: ${c}`);{const t=await i.json();this.f=l.fromJSON(t)}}this.n.clear();const h=Date.now();this.g=h+1e3*this.c;const d=Date.parse(i.headers.get("date"));this.setClockDrift(h-d),a(v,this.getClockDrift()),n(this.e,o,r),this.h=!1}catch(e){return this.h=!1,this.disconnect(t?"unregister":"reconnect")}}}var R;function k(t,e){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&(s[i[r]]=t[i[r]])}return s}function S(t,e){if(!e)return t.toString();try{return new URL(e).toString()}catch(s){if(e.startsWith("//"))return`${t.protocol}${e}`;if(e.startsWith("/"))return`${t.origin}${e}`;const i=function t(e){return e.startsWith("/")?t(e.substr(1)):e}(t.pathname).split("/"),r=e.split("/");i.pop();for(const t of r)".."===t?i.pop():"."===t||i.push(t);return`${t.origin}/${i.join("/")}`}}class x{}x.propName="";class q extends x{constructor(t=[]){super(),this.AQ=t}matches(t,e){return!!this.AQ.length&&this.AQ.every(s=>s.matches(t,e))}toJSON(){const t={};for(const e of this.AQ){t[e.constructor.propName]=e.toJSON()}return t}fromJSON(t){if("string"==typeof t)return this.fromJSON(s(t));for(const[e,s]of Object.entries(t)){if(!V[e])throw new Error(`Illegal rule: ${e}`);{const t=new V[e];t.fromJSON(s),this.addCondition(t)}}return this}addCondition(t){return this.AQ.push(t)}removeCondition(t){const e=this.AQ.indexOf(t);return!(e<0)&&(this.AQ.splice(e,1),!0)}}function C(t,e){return e instanceof Array?e.some(e=>C(t,e)):e instanceof RegExp?e.test(t):t.startsWith(e)}!function(t){t.Document="document",t.Audio="audio",t.Video="video",t.Track="track",t.Image="image",t.Style="style",t.Script="script",t.Font="font"}(R||(R={}));const O=[R.Document,R.Script,R.Style];function N(t,e){return new Request(t,e)}function P(t,e,s={}){const i=new Headers,r=["accept","accept-language","content-language","content-type"];for(const[e,s]of t.headers)r.includes(e.toLocaleLowerCase())&&i.append(e,s);const n={headers:i,credentials:"omit"};return"navigate"!==t.mode&&(n.mode=t.mode),new Request(e,Object.assign(n,s))}function F(t){const e=E(t),{pathname:s}=new URL(t.url),i=".svg"===U(s);return!e||O.includes(e)||i}function E(t){const e=function(t){for(const e of Object.values(R))if(e===t)return e;return null}(t.destination||"");if(e)return e;const s=function(t){const e=[];if(!t||"*/*"===t)return null;(t.includes("text/html")||t.includes("application/xhtml+xml"))&&e.push(R.Document);t.includes("text/css")&&e.push(R.Style);(t.includes("text/javascript")||t.includes("application/javascript"))&&e.push(R.Script);t.includes("image/")&&e.push(R.Image);t.includes("font/")&&e.push(R.Font);t.includes("video/")&&e.push(R.Video);t.includes("audio/")&&e.push(R.Audio);t.includes("text/vtt")&&e.push(R.Track);return 1===e.length?e[0]:null}(t.headers.get("Accept")||"");if(s)return s;if("navigate"===t.mode)return R.Document;const{pathname:i}=new URL(t.url),r=function(t){switch(t){case".js":return R.Script;case".html":case".htm":return R.Document;case".css":return R.Style;case".woff2":case".woff":case".ttf":case".otf":case".eot":return R.Font;case".mp3":case".wav":return R.Audio;case".vtt":return R.Track;case".png":case".jpeg":case".jpg":case".gif":case".svg":case".ico":case".webp":return R.Image;case".mp4":case".ogg":case".ogv":case".webm":return R.Video;default:return null}}(U(i));return r||(i.endsWith("/")?R.Document:null)}function U(t){const e=t.lastIndexOf(".");return-1===e||t.lastIndexOf("/")>e?"":t.substr(e).toLowerCase()}class $ extends x{constructor(t=[]){super(),this.AR=t}matches(t,e){if(!this.AR.length)return!1;const s=E(t);return!!s&&this.AR.includes(s)}toJSON(){return this.AR}fromJSON(t){if("string"==typeof t)return this.fromJSON(s(t));if(t instanceof Array)return this.AR=t,this;throw new Error("Invalid ContentTypeCondition JSON")}}$.propName="contentType";class L extends x{constructor(t){super(),this.Ad=t}test(t){return null!=this.Ad&&C(t,this.Ad)}toJSON(){return this.Ad?function t(e){return e instanceof Array?e.map(e=>t(e)):e instanceof RegExp?i(e):e}(this.Ad):null}fromJSON(t){if(null==t||"null"===t)return this.Ad=null,this;try{return this.fromJSON(s(t))}catch(t){}return this.Ad=t,this}}function I(t){const[,e]=/^(?:(?:\w+?:)?\/\/)?(.*)$/.exec(t);return e}function W(t){const[,e,s,i,r,n,a]=/^(?:(https?:)\/\/)?(([\w.-]+)(?::(\d+))?)([^#]*)(#.*)?$/.exec(t);return{protocol:e,host:s,hostname:i,port:r,pathname:n,hash:a}}class D extends L{matches(t,e){return!!e&&(!!I(t.url).startsWith(location.host)&&e.keys().some(t=>this.test(t)))}}D.propName="cookie";class _ extends x{matches(t,e){const s=t.headers.get("user-agent")||navigator.userAgent;return!s||this.userAgentMatches(s)}toJSON(){return!0}fromJSON(t){return this}}class j extends _{userAgentMatches(t){const e=t.toLowerCase();return e.includes("wow64")||e.includes("windows nt")||e.includes("win64")||e.includes("msie")||e.includes("macintosh;")||e.includes("linux x86_64")}}j.propName="desktop";class J extends L{matches(t,e){return this.test(W(t.url).host)}}J.propName="host";class T extends _{userAgentMatches(t){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|symbian|treo|up\.(?:browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br[ev]w|bumb|bw\-[nu]|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c[- ]|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}}T.propName="mobile";class z extends L{matches(t,e){return this.test(W(t.url).pathname)}}z.propName="pathname";class B extends x{constructor(t=[]){super(),this.AS=t}get size(){return this.AS.length}toJSON(){return this.AS.map(t=>t.toJSON())}fromJSON(t){if("string"==typeof t)return this.fromJSON(s(t));if(t instanceof Array)return this.AS=t.map(t=>(new q).fromJSON(t)),this;throw new Error("Invalid RuleSet JSON")}matches(t,e){return this.AS.some(s=>s.matches(t,e))}[Symbol.iterator](){return this.AS[Symbol.iterator]()}addRule(t){return this.AS.push(t)}removeRule(t){const e=this.AS.indexOf(t);return!(e<0)&&(this.AS.splice(e,1),!0)}}class M extends _{userAgentMatches(t){const e=t.toLowerCase();return e.includes("tablet")||e.includes("ipad")||e.includes("nexus 7")||e.includes("nexus 10")||e.includes("silk/")||!!e.match(/\bgt-[pn]\d{4}\b/)}}M.propName="tablet";class K extends _{userAgentMatches(t){const e=t.toLowerCase();return e.includes("appletv")||e.includes("apple tv")||e.includes("googletv")||e.includes("crkey")||e.includes("armv7l")||e.includes("aftt")||e.includes("aftm")||e.includes("roku")||e.includes("bravia")||e.includes("philipstv")||e.includes("tsbnettv")||e.includes("smarttv")||!!e.match(/\btv\b/)}}K.propName="tv";class Q extends L{matches(t,e){return this.test(I(t.url))}}Q.propName="url";const V={[$.propName]:$,[D.propName]:D,[j.propName]:j,[J.propName]:J,[T.propName]:T,[z.propName]:z,[M.propName]:M,[K.propName]:K,[Q.propName]:Q};class H{constructor(t=""){this.b=t}fromString(t){this.b=t}getItem(t){if(!t)return null;const e=encodeURIComponent(t).replace(/[-.+*]/g,"\\$&"),s=new RegExp(`(?:(?:^|.*;)\\s*${e}\\s*\\=\\s*([^;]*).*$)|^.*$`);return decodeURIComponent(this.b.replace(s,"$1"))||null}keys(){return this.b.replace(/((?:^|\s*;)[^=]+)(?=;|$)|^\s*|\s*(?:=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:=[^;]*)?;\s*/).map(t=>decodeURIComponent(t))}}class Y{static fromEvent(t,e=new H){const s="navigate"===t.request.mode;return new Y(t.request,t.request,t.request.url,t.clientId,e,s)}static fromUrl(t,e,s,i=!1){const r=new Request(t);return new Y(r,r,t,e,s,!1,i)}constructor(t,e,s,i,r,n,a=!1){this.S=new URL(t.url),this.T=s,this.U=t,this.V=e,this.X=i,this.Y=r,this.W=n,this.Z=a}get client(){return clients.get(this.X)}get clientId(){return this.X}get request(){return this.U}get originalRequest(){return this.V}get url(){return this.S}get cacheKey(){return this.T}get cookies(){return this.Y}isNavigateRequest(){return this.W}isCritical(){return this.Z}cloneURL(){return new URL(this.S.toString())}withURL(t){const e=t.toString();if(this.S.toString()===e)return this;const s=P(this.U,e);return new Y(s,this.V,this.T,this.X,this.Y,this.W,this.Z)}withMethod(t){if(this.U.method.toUpperCase()===t)return this;const e=N(this.U,{method:t});return new Y(e,this.V,this.T,this.X,this.Y,this.W,this.Z)}withMode(t){if(this.U.mode===t)return this;const e=N(this.U,{mode:t});return new Y(e,this.V,this.T,this.X,this.Y,this.W,this.Z)}withCache(t){if(this.U.cache===t)return this;const e=N(this.U,{cache:t});return new Y(e,this.V,this.T,this.X,this.Y,this.W,this.Z)}withCacheKey(t){return new Y(this.U,this.V,t,this.X,this.Y,this.W,this.Z)}asCritical(){return new Y(this.U,this.V,this.T,this.X,this.Y,this.W,!0)}}const X=-1,G=0,Z="https://fetch.origin.time/",tt=2;class et{constructor(t){this.originFetchDelay=5e3,this.AY=null,this.AZ=null,this.Aa=!0,this.Ab={blacklist:new B,whitelist:new B,delayed:new B,cacheAll:!1,disableCache:!1,userAgentDetection:!1,enabledSites:new B,criticalResources:[],fetchOriginInterval:-1,stripQueryParams:null,image:this.AX()},Object.assign(this.Ab,t)}isCachingEnabled(){return!this.Ab.disableCache}shouldCacheRequest(t,e=!1){const{request:s,cookies:i,url:r}=t;return!this.Ab.disableCache&&(!!this.Ab.cacheAll||!(this.Ab.whitelist.size&&!this.Ab.whitelist.matches(s,i))&&(!this.Ab.blacklist.matches(s,i)&&(!!e||(this.Ab.enabledSites.size&&"navigate"===s.mode&&(this.Aa=this.Ab.enabledSites.matches(s,i)),this.Aa))))}shouldDelayRequest(t){return!!this.Ab.delayed.matches(t.request,t.cookies)}async isEnabledOnSite(t){return!!t.isNavigateRequest()||this.AT(t,this.Ab.enabledSites)}async isEnabledOnClientURL(t,e=this.Ab.enabledSites){if(!e.size)return!0;const s=e.matches(new Request(t.url));return s}async AT(t,e){return!e||!e.size||(t.isNavigateRequest()?e.matches(t.request,t.cookies):this.isEnabledOnClientURL(await t.client,e))}getUserAgentClass(t){if(!this.Ab.userAgentDetection)return null;const e=t.headers.get("user-agent")||navigator.userAgent||navigator.vendor,s="navigate"===t.mode&&e!==this.AZ;return null==this.AY||s?(this.AZ=e,this.AU(e)?this.AY="mobile":this.AV(e)?this.AY="tablet":this.AY=this.AW(e)?"tv":"desktop"):this.AY}async shouldFetchOrigin(t){if("navigate"!==t.mode||this.Ab.fetchOriginInterval===X)return!1;if(this.Ab.fetchOriginInterval===G)return!0;const e=Math.floor(Date.now()/1e3),s=await c(Z,e);return s<=e&&(await a(Z,s+this.Ab.fetchOriginInterval+tt),!0)}async getImageOptions(t){const e=this.AX();if(this.Ab.image instanceof Array){for(const s of this.Ab.image){if(!s.rules||s.rules.matches(t.request)){await this.AT(t,s.enabledSites)&&Object.assign(e,s.options)}}return e}return Object.assign(e,this.Ab.image)}shouldStripQueryParameter(t){return null!==this.Ab.stripQueryParams&&C(t,this.Ab.stripQueryParams)}async getCriticalResources(t){const e=[];for(const{enabledOn:s,resources:i}of this.Ab.criticalResources)await this.AT(t,s)&&e.push(...i);return e.filter((t,s)=>e.indexOf(t)===s)}AU(t){const e=t;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|symbian|treo|up\.(?:browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br[ev]w|bumb|bw\-[nu]|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c[- ]|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}AV(t){if(["iPad","Linux armv"].some(t=>navigator.platform.startsWith(t)))return!0;return t.includes("Tablet PC")}AW(t){const e=navigator.platform.toLowerCase();if(["nintendo","playstation"].some(t=>e.startsWith(t)))return!0;const s=t;return!!(s.toLowerCase().includes("appletv")||s.includes("googletv")||s.includes("smarttv"))}AX(){return{downscale:!0,screenSizeFactor:1,maxWidth:!1,maxHeight:!1,quality:85,webp:!0,pjpeg:!0,crop:!1}}}class st{constructor(){this.Ac=new Promise(t=>{this.resolver=t})}finish(){this.resolver&&this.resolver()}waitForRequest(){return this.Ac}}class it{constructor(e,s={},i=location.origin){this.AP=new Map,this.bloomFilterProvider=e,this.options=new et(s),this.appUrl=i+"/";const[r,n]=t();this.AO=!("Chrome"===r&&n<64||"Firefox"===r&&n<61)}async handleRequest(t,e){const s=this.AA(t),i=await o(new Request(s.cacheKey),this.AN(s.request));if(e&&(e.waitFor(this.AD(s.originalRequest)),e.finishWaiting(!0)),i)return this.AE(s,i);if(s.isNavigateRequest()){const t=await this.options.getCriticalResources(s);if(t.length>0)for(const e of t){const t=Y.fromUrl(e,s.clientId,s.cookies,!0).withURL(e).asCritical();this.handleRequest(t)}}if(!s.url.toString().startsWith(location.origin))return this.AG(s);const r=await this.AC(s);return r||this.AG(s)}handleExternalRequest(t){if("navigate"===t.mode)return this.AK(t);const e=N(t,{mode:this.AM(t)});return this.AK(e)}shouldHandle(t,e=!1){return this.options.shouldCacheRequest(t,e)}isEnabledOnSite(t){return this.options.isEnabledOnSite(t)}isEnabledOnClientURL(t,e){return this.options.isEnabledOnClientURL(t,e)}async fetchEnhanced(t){try{const e=this.AM(t.request),s=this.bloomFilterProvider.isStale(t.cacheKey)?"no-cache":"default",i=t.withMode(e).withCache(s);return await this.AK(i.request)}catch(t){const e=t instanceof TypeError?u.FetchTypeError:u.BadGateway;return new Response(t.message,{status:e})}}AA(t){const e=t.cloneURL();for(const t of Array.from(e.searchParams.keys()))this.options.shouldStripQueryParameter(t)&&e.searchParams.delete(t);return e.hash&&(e.hash=""),e.searchParams.sort(),t.withMethod("GET").withURL(e).withCacheKey(e.toString())}async AB(t){const e=t.url,s=this.AP.get(e);return!!s&&(await s.waitForRequest(),!0)}async AC(t){if(t.isNavigateRequest()||!this.AO)return null;const e=t.originalRequest.url;try{const t=await fetch(e,{mode:"same-origin",cache:"only-if-cached"});if(g(t,this.bloomFilterProvider.getClockDrift()))return t}catch(t){}return null}async AD(t){if(await this.options.shouldFetchOrigin(t)){await d(1e3*tt);try{await this.AK(t)}catch(t){}}}async AE(t,e){return navigator.onLine?await this.AF(t,e)?e:this.AG(t):e}async AF(t,e){return!!g(e,this.bloomFilterProvider.getClockDrift())&&(await this.AL(t)&&!this.isCorrupted(t,e))}isCorrupted(t,e){return!1}async AG(t){if(await this.AB(t.request)){const e=await o(new Request(t.cacheKey),this.AN(t.request));if(e)return this.AE(t,e)}return t.isCritical()&&this.AP.set(t.url.toString(),new st),this.AH(t)}async AH(t){const e=await this.fetchEnhanced(t);return this.AI(t,e)}async AI(t,e){return e.status>=u.InternalServerError&&(this.AJ(t.request),!t.isCritical())?(this.bloomFilterProvider.disconnect("reconnect"),this.AK(t.originalRequest)):e.status>=u.BadRequest&&(this.AJ(t.request),!t.isCritical())?this.AK(t.originalRequest):this.options.isCachingEnabled()?(n(new Request(t.cacheKey),e.clone(),this.AN(t.request)).then(()=>{this.bloomFilterProvider.addToRevalidationWhitelist(t.request.url),this.AJ(t.request)}).catch(e=>{this.AJ(t.request)}),e):(this.AJ(t.request),e)}AJ(t){const e=this.AP.get(t.url);e&&(e.finish(),this.AP.delete(t.url))}AK(t){return fetch(t)}async AL(t){t.url.toString();if(!this.bloomFilterProvider.isFromSameSession())return!1;if(t.isNavigateRequest()){if("reload"===t.request.cache)return await this.bloomFilterProvider.purgeBloomFilter(),!1;"no-cache"===t.request.cache&&this.bloomFilterProvider.fetchBloomFilter()}return!this.bloomFilterProvider.isStale(t.cacheKey)}AM(t){const e=t.url;return e.startsWith(location.origin)?"same-origin":t.headers.has("origin")||e.startsWith(this.appUrl)?"cors":"no-cors"}AN(t){const e=this.options.getUserAgentClass(t)||"assets";return`${r}-${e}-${this.bloomFilterProvider.getRevision()}`}}class rt extends it{constructor(t,e={},s=location.origin){super(t,e,s),this.apiPrefix=`${s}/v1/`,this.assetPrefix=`${this.apiPrefix}asset/`}async u(t){return this.w(t.request)?t:this.x(t)}async fetchEnhanced(t){const e=await this.u(t),s=await super.fetchEnhanced(e),i=await this.handleRedirect(s,t.request);return this.v(t.request,i)}isCorrupted(t,e){return!(!e.url||!F(t.request))&&e.url.includes("/v1/asset/")}async v(t,e){if(!F(t))return e;const s=await async function(t,e={}){const s={status:t.status,statusText:t.statusText,headers:t.headers},i=Object.assign(s,e);if(!t.body)return await w(t,i);try{return new Response(t.body,i)}catch(e){return await w(t,i)}}(e);return Object.defineProperty(s,"url",{value:t.url}),s}w(t){return t.url.startsWith(this.apiPrefix)}async x(t){const{request:e,url:s}=t;s.hash="";const i=this.options.getUserAgentClass(e);i&&"desktop"!==i&&s.searchParams.append("bqvariation",i);const r=await this.y(t.withURL(s)),n=this.assetPrefix+r.toString();return t.withURL(n)}async y(t){const{request:e}=t,s=t.cloneURL();if(E(e)!==R.Image)return s;if(".svg"===U(s.pathname))return s;const i=[],r=await this.options.getImageOptions(t),n=await this.z(e,r);n&&i.push(n),r.webp&&i.push("auto=webp"),100!==r.quality&&i.push(`quality=${r.quality}`),r.pjpeg&&s.pathname.match(/\.jpe?g$/i)&&i.push("format=pjpeg");const a=r.crop;if(a)if("string"==typeof a)i.push(`crop=${a},smart`);else if(a instanceof Array)if(a.length>=4){const[t,e,s,r]=a;i.push(`crop=${s},${r},x${t},y${e}`)}else if(a.length>=2){const[t,e]=a;i.push(`crop=${t},${e},smart`)}return i.length&&(s.searchParams.append("bqoptimize","1"),s.search+=`;${i.join(";")}`),s}async z(t,e){const s=t.headers.get("width");if(null!==s)return`width=${this._(parseInt(s,10))}`;if(!e.downscale)return null;if(e.maxHeight)return`height=${e.maxHeight}`;const i=await this.$(e),r=e.maxWidth?e.maxWidth:i;return isFinite(r)&&r>0?`width=${r}`:null}async $(t){if(this.screen||(this.screen=await c(`${location.origin}/com.baqend.speedkit.screen`)),this.screen){const{width:e,dpr:s}=this.screen,i=e||1/0,r=(s||1)*(t.screenSizeFactor||1);return this._(i*r)}return NaN}_(t){return t<=240?240:t<=375?375:t<=576?576:t<=768?768:t<=992?992:t<=1200?1200:t<=1920?1920:t<=2560?2560:t<=3840?3840:t}}class nt extends rt{constructor(t,e){const{whitelist:s,blacklist:i,delayed:r,appName:n,enabledSites:a,criticalResources:o,image:c}=e,h=k(e,["whitelist","blacklist","delayed","appName","enabledSites","criticalResources","image"]),l=Object.assign({appDomain:"{}.app.baqend.com".replace("{}",n),cacheAll:!1,disableCache:!1,userAgentDetection:!1,fetchOriginInterval:-1,whitelist:(new B).fromJSON(s||[]),blacklist:(new B).fromJSON(i||[]),delayed:(new B).fromJSON(r||[]),enabledSites:(new B).fromJSON(a||[]),criticalResources:nt.initCriticalResources(o),image:nt.initImage(c),preloadBloomFilter:!0,stripQueryParams:!1},h),{appDomain:u}=l;super(t,k(l,["appDomain"]),`https://${u}`)}async handleRedirect(t,e){if(t.status===u.BaqendRedirect){const s=this.o(e,t.headers.get("location")),i=new Headers(t.headers);return i.set("location",s),new Response(null,{headers:i,status:u.MovedPermanently,statusText:t.statusText})}return t}o(t,e){if(e.startsWith("http"))return e;if(e.startsWith("//"))return`https:${e}`;const s=new URL(t.url);if(e.startsWith("/"))return`${s.origin}${e}`;const i=`${s.origin}${s.pathname}`;return i.endsWith("/")?`${i}${e}`:`${i.substr(0,i.lastIndexOf("/")+1)}${e}`}static initImage(t){return t?t instanceof Array?t.map(t=>({enabledSites:t.enabledSites&&(new B).fromJSON(t.enabledSites),rules:t.rules&&(new B).fromJSON(t.rules),options:nt.normalizeImageOptions(t.options)})).reverse():nt.normalizeImageOptions(t):{}}static normalizeImageOptions(t){return"number"==typeof t.quality?t.quality=Math.max(1,Math.min(100,Math.round(t.quality))):!1===t.quality&&(t.quality=100),t}static initCriticalResources(t=[]){return t.length?t.map(nt.makeResourceRule).map(nt.normalizeResourceURLs).map(nt.instantiateResourceEnabledOn).reverse():[]}static makeResourceRule(t){return"string"==typeof t?{resources:[t]}:t}static normalizeResourceURLs({enabledOn:t,resources:e}){const s=new URL(location.href);return{enabledOn:t,resources:e.map(t=>S(s,t))}}static instantiateResourceEnabledOn({enabledOn:t,resources:e}){return{enabledOn:t&&(new B).fromJSON(t),resources:e}}}class at{constructor(){this.a=[]}startWaiting(){return new Promise((t,e)=>{this.waitPromiseResolver=t})}waitFor(t){this.a.push(t)}async finishWaiting(t){await Promise.all(this.a),this.waitPromiseResolver&&this.waitPromiseResolver(t)}}class ot{constructor(t){t.addEventListener("install",t=>{t.waitUntil(this.install())}),t.addEventListener("activate",t=>{t.waitUntil(this.activate(t).then(()=>clients.claim()))}),t.addEventListener("fetch",t=>{this.fetch(t)}),t.addEventListener("push",t=>{this.push(t)}),t.addEventListener("notificationclick",t=>{this.notificationclick(t)})}async install(){return skipWaiting()}}const ct=`${location.origin}/com.baqend.speedkit.config`,ht=`${location.origin}/com.baqend.speedkit.cookie`,lt="bqpassthrough";new class extends ot{constructor(t){super(t),this.O=!1,this.P=!1,this.Q=0,this.R=new H,t.addEventListener("message",t=>{t.waitUntil(this.G(t))})}async activate(t){await this.K()}push(t){if(!t.data)return;const e=t.data.json();if(e.isBaqend){const{title:s}=e;t.waitUntil(registration.showNotification(s,e))}}fetch(e){const s=Y.fromEvent(e,this.R),{request:i,url:r}=s,n=this.P;if(s.isNavigateRequest()&&(this.Q=0,this.P=!1),!this.E(i))return;if(function(t){return"GET"!==t.method&&"HEAD"!==t.method}(i))return void(s.isNavigateRequest()&&(this.O=!0));if(this.O&&s.isNavigateRequest())return void(this.O=!1);if(function(t){return"dynamic"===t.headers.get("baqend-speed-kit-request")}(i))return n?void 0:void e.respondWith(this.F());if(navigator.onLine&&this._bloomFilterProvider&&this._bloomFilterProvider.isDisconnected())return;if(this._workerCache&&!this._workerCache.shouldHandle(s)&&!this._workerCache.options.shouldDelayRequest(s))return;const a=new at;e.waitUntil(a.startWaiting());const[o,c]=t();"Firefox"===o&&59===c&&!s.isNavigateRequest()&&i.url.includes("#")&&F(i)||e.respondWith((async()=>(await this.K(),this._workerCache&&this._bloomFilterProvider?navigator.onLine&&this._bloomFilterProvider.isDisconnected()?this._workerCache.handleExternalRequest(i):this._workerCache.options.shouldDelayRequest(s)?r.searchParams.get(lt)?(r.searchParams.delete(lt),fetch(P(i,r.toString()))):await this._workerCache.isEnabledOnSite(s)?this.A(i):this._workerCache.handleExternalRequest(i):this._workerCache.shouldHandle(s)&&await this._workerCache.isEnabledOnSite(s)?(await this._bloomFilterProvider.init(),s.isNavigateRequest()&&(this.P=!0),this._workerCache.handleRequest(s,a)):this._workerCache.handleExternalRequest(i):fetch(i)))())}async A(t){const e=E(t);return e===R.Script?this.B(t):e===R.Image?this.C(t):fetch(t)}B(t){const e=new URL(t.url);e.searchParams.append(lt,"1");const s=`(function(){\n  const thisNode = document.currentScript;  \n  function loadScript() {\n    const scr = document.createElement('script');\n    for (let i = 0, len = thisNode.attributes.length; i < len; i++) {\n      var attr = thisNode.attributes.item(i);\n      scr.setAttribute(attr.nodeName, attr.nodeValue);\n    }\n    scr.async = true;\n    scr.src = '${e}';\n    thisNode.parentNode.replaceChild(scr, thisNode);\n  }\n  \n  function documentComplete(cb) {\n    if (document.readyState === 'complete') {\n      return cb();\n    }\n    \n    document.addEventListener('readystatechange', () => {\n      if (document.readyState === 'complete') {\n        cb();\n      }\n    });\n  }\n  \n  documentComplete(() => {\n    window.setTimeout(() => {\n      loadScript();\n    }, 1000);\n  });\n})();\n`;return new Response(s,this.D("application/javascript; charset=utf-8"))}C(t){const e=Uint8Array.from([71,73,70,56,57,97,1,0,1,0,128,0,0,0,0,0,255,255,255,33,249,4,1,0,0,0,0,44,0,0,0,0,1,0,1,0,0,2,1,68,0,59]);return d(1e3).then(()=>fetch(t)).catch(console.error),new Response(e,this.D("image/gif"))}D(t){return{headers:{"content-type":t}}}E(t){return!(!function(t){return t.url.startsWith("http")}(t)||t.url.length>3800||"same-origin"===t.mode)}async F(){return new Response(null,{status:304,statusText:"Page was not served via Speed Kit"})}async G(t){const e=t.data;switch(e.type){case"send-config":return this.H(e.data.config,e.data.cookie);case"send-cookies":return this.I(e.data,e.event);case"clear-cache":return async function(){const t=(await caches.keys()).filter(t=>t.startsWith(r)).map(t=>caches.delete(t));return await Promise.all(t)}();case"prewarm-fetch":return this.J(t.source,e.data);case"disconnect":return this._bloomFilterProvider&&this._bloomFilterProvider.disconnect("noReconnect");case"connect":return this._bloomFilterProvider&&this._bloomFilterProvider.connect();case"fetch-bloom-filter":return this._bloomFilterProvider&&this._bloomFilterProvider.fetchBloomFilter();default:throw new Error(`Received unsupported ${e.type} message`)}}async H(t,e){return this.L(t),this.M(e),Promise.all([a(ct,t),a(ht,e)])}async I(t,e){return"load"===e&&(this.Q+=1,2===this.Q&&this._bloomFilterProvider&&this._bloomFilterProvider.fetchBloomFilter()),this.M(t),a(ht,t)}async J(t,e){if(!this._workerCache)return;if(await this._workerCache.isEnabledOnClientURL(t))return;const{id:s,url:i}=t,r=new URL(i);for(const{url:t}of e){const e=Y.fromUrl(t,s,this.R);if(e.url.origin!==r.origin&&this._workerCache.shouldHandle(e,!0)&&!await caches.match(t))return void await this._workerCache.handleRequest(e)}}async K(){if(this._workerCache)return;const[t,e]=await Promise.all([c(ht),c(ct)]);if(t&&this.M(t),e)try{await this.L(e)}catch(t){}}async L(t){if(!this._workerCache){if(!this._bloomFilterProvider){const e=t=>60*t,s=null!=t.maxStaleness?t.maxStaleness/1e3:null,i=t.refreshInterval||s||300,r=null!=t.staleWhileRevalidate?t.staleWhileRevalidate:e(30),n=t.reconnectInterval||6e4,a=`https://${t.appDomain||"{}.app.baqend.com".replace("{}",t.appName)}/v1/bloomfilter`;this._bloomFilterProvider=new A(n,i,r,a),!1!==t.preloadBloomFilter&&await this._bloomFilterProvider.init()}this._workerCache=new nt(this._bloomFilterProvider,t)}}M(t){this.R.fromString(t)}notificationclick(t){const e=t.notification;if(e.data.isBaqend){const s=t.action,i=e.data.closeNotification;if("close"===s)return e.close();t.waitUntil(this.N(e.data.launchUrl)),i&&setTimeout(e.close.bind(e),1e4)}}async N(t){if(t)return clients.openWindow(t);const e=await clients.matchAll();return e.length>0?e[0].focus():clients.openWindow("/")}}(self);